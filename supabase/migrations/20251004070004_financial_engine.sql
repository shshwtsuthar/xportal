-- 00007_financial_engine.sql
-- (Content is identical to the previous version)
CREATE TABLE public.payment_plan_templates ( id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(), rto_id UUID NOT NULL REFERENCES public.rtos(id) ON DELETE CASCADE, qualification_id UUID NOT NULL REFERENCES public.qualifications(id) ON DELETE CASCADE, name TEXT NOT NULL, is_default BOOLEAN DEFAULT FALSE );
CREATE TABLE public.payment_plan_template_installments ( id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(), template_id UUID NOT NULL REFERENCES public.payment_plan_templates(id) ON DELETE CASCADE, name TEXT NOT NULL, amount_cents INT NOT NULL, due_date_rule_days INT NOT NULL );
CREATE TABLE public.invoices ( id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(), enrollment_id UUID NOT NULL REFERENCES public.enrollments(id) ON DELETE CASCADE, rto_id UUID NOT NULL REFERENCES public.rtos(id) ON DELETE CASCADE, status invoice_status NOT NULL DEFAULT 'DRAFT', invoice_number TEXT NOT NULL UNIQUE, issue_date DATE NOT NULL, due_date DATE NOT NULL, amount_due_cents INT NOT NULL, amount_paid_cents INT DEFAULT 0 );
CREATE TABLE public.payments ( id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(), invoice_id UUID NOT NULL REFERENCES public.invoices(id) ON DELETE CASCADE, rto_id UUID NOT NULL REFERENCES public.rtos(id) ON DELETE CASCADE, payment_date DATE NOT NULL, amount_cents INT NOT NULL, reconciliation_notes TEXT );